name: è‡ªåŠ¨æ›´æ–°AIæ–°é—»æ•°æ®

on:
  # å®šæ—¶ä»»åŠ¡ï¼šæ¯6å°æ—¶è¿è¡Œä¸€æ¬¡
  schedule:
    - cron: '0 */6 * * *'  # UTCæ—¶é—´ï¼Œæ¯6å°æ—¶æ‰§è¡Œä¸€æ¬¡
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

# è®¾ç½®æƒé™
permissions:
  contents: write

jobs:
  update-news:
    runs-on: ubuntu-latest
    
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
      
      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: æ”¶é›†AIæ–°é—»æ•°æ®
        run: |
          python data_collector.py
        continue-on-error: true
      
      - name: æ›´æ–° latest_news.json
        run: |
          # æ‰¾åˆ°æœ€æ–°çš„æ•°æ®æ–‡ä»¶å¹¶å¤åˆ¶ä¸º latest_news.json
          LATEST_FILE=$(ls -t ai_news_*.json 2>/dev/null | head -1)
          if [ -n "$LATEST_FILE" ]; then
            cp "$LATEST_FILE" latest_news.json
            echo "å·²æ›´æ–° latest_news.json ä» $LATEST_FILE"
          else
            echo "æœªæ‰¾åˆ°æ–°çš„æ•°æ®æ–‡ä»¶"
          fi
      
      - name: æäº¤å¹¶æ¨é€æ›´æ–°
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add -A
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
          if git diff --staged --quiet; then
            echo "æ²¡æœ‰æ–°çš„æ›´æ”¹éœ€è¦æäº¤"
          else
            git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°AIæ–°é—»æ•°æ® - $(date +'%Y-%m-%d %H:%M')"
            git push
            echo "âœ… æ•°æ®å·²æ›´æ–°å¹¶æ¨é€"
          fi
